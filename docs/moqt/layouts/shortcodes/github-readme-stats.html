{{- $user := .Get "user" -}}
{{- $repo := .Get "repo" -}}
{{- $version := .Get "version" | default "" -}}
{{- $icon := .Get "icon" | default "" -}}
{{- $defaultLink := cond (eq $version "") (printf "https://github.com/%s/%s/tree/main" $user $repo) (printf "https://github.com/%s/%s/releases/tag/%s" $user $repo $version) -}}
{{- $link := .Get "link" | default $defaultLink -}}
{{- $content := cond (eq $version "") "New in main branch" (printf "New in %s" $version) -}}

<div id="github-card-{{$user}}-{{$repo}}"
  style="box-shadow:0 4px 24px rgba(0,0,0,0.32); border-radius:18px; border:1.5px solid #23272e; padding:20px 24px; display:flex; align-items:flex-start; background:#181c20; transition:box-shadow 0.2s, border-color 0.2s; gap:18px; margin:12px 0; max-width:420px; min-width:420px; min-height:200px; cursor:pointer;"
  onmouseover="this.style.boxShadow='0 0 0 1px #aaffcc44';this.style.borderColor='#aaffcc';"
  onmouseout="this.style.boxShadow='0 4px 24px rgba(0,0,0,0.32)';this.style.borderColor='#23272e';"
>
  <div style="width:56px; height:56px; background:#23272e; border-radius:30%; margin-right:8px; display:flex; align-items:center; justify-content:center;">
    <img id="github-avatar-{{$user}}-{{$repo}}" src="" width="56" height="56" style="border-radius:30%; box-shadow:0 2px 8px rgba(0,0,0,0.18); display:none;">
  </div>
  <div style="flex:1; min-width:0; display:flex; flex-direction:column;">
    <div style="font-weight:600; font-size:1.1rem; color:#f3f4f6; margin-bottom:2px;">
      <span id="github-fullname-{{$user}}-{{$repo}}">{{$user}}/<span style="color:#60a5fa;">{{$repo}}</span></span>
    </div>
    <div id="github-desc-{{$user}}-{{$repo}}" style="font-size:0.97rem; color:#b0b6be; margin-bottom:auto; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; text-overflow:ellipsis;">
      Loading...
    </div>
    <div style="display:flex; gap:16px; font-size:0.93rem; color:#b0b6be; align-items:center; margin-top:10px;">
      <span style="display:flex; align-items:center;">
        <svg width="16" height="16" fill="#ffe066" style="margin-right:3px;" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.286 3.967a1 1 0 00.95.69h4.175c.969 0 1.371 1.24.588 1.81l-3.38 2.455a1 1 0 00-.364 1.118l1.287 3.966c.3.922-.755 1.688-1.54 1.118l-3.38-2.454a1 1 0 00-1.175 0l-3.38 2.454c-.784.57-1.838-.196-1.54-1.118l1.287-3.966a1 1 0 00-.364-1.118L2.05 9.394c-.783-.57-.38-1.81.588-1.81h4.175a1 1 0 00.95-.69l1.286-3.967z"/></svg>
        <span id="github-stars-{{$user}}-{{$repo}}">-</span>
      </span>
      <span style="display:flex; align-items:center;">
        <svg width="16" height="16" fill="#60a5fa" style="margin-right:3px;" viewBox="0 0 20 20"><path d="M5 3a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2V5a2 2 0 00-2-2H5zm10 2v.217l-5 3.125-5-3.125V5h10zm-10 2.383l4.445 2.778a1 1 0 001.11 0L15 7.383V15H5V7.383z"/></svg>
        <span id="github-forks-{{$user}}-{{$repo}}">-</span>
      </span>
    </div>
    <div style="margin-top:0.5rem;">
      <a href="{{$link}}" title="{{$link | plainify}}" target="_blank">
        {{- partial "shortcodes/badge" (dict "content" $content "border" true "icon" $icon) -}}
      </a>
    </div>
  </div>
</div>
<script>
(function(){
  const githubUser = '{{$user}}';
  const githubRepo = '{{$repo}}';
  const card = document.getElementById(`github-card-${githubUser}-${githubRepo}`);
  fetch(`https://api.github.com/repos/${githubUser}/${githubRepo}`)
    .then(r => r.json())
    .then(data => {
      document.getElementById(`github-desc-${githubUser}-${githubRepo}`).textContent = data.description || "No description.";
      document.getElementById(`github-stars-${githubUser}-${githubRepo}`).textContent = data.stargazers_count;
      document.getElementById(`github-forks-${githubUser}-${githubRepo}`).textContent = data.forks_count;
      document.getElementById(`github-avatar-${githubUser}-${githubRepo}`).src = data.owner.avatar_url;
      document.getElementById(`github-avatar-${githubUser}-${githubRepo}`).style.display = "block";
      card.onclick = function(){ window.open(data.html_url, '_blank'); };
      card.style.cursor = "pointer";
    });
})();
</script>