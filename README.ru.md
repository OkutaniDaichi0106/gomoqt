# gomoqt

Реализация Media over QUIC Transport (MOQT) на Go, реализующая
спецификацию MOQ Lite для эффективной потоковой передачи мультимедиа по QUIC.

[![Go Reference](https://pkg.go.dev/badge/github.com/OkutaniDaichi0106/gomoqt.svg)](https://pkg.go.dev/github.com/OkutaniDaichi0106/gomoqt)
[![codecov](https://codecov.io/gh/OkutaniDaichi0106/gomoqt/branch/main/graph/badge.svg?token=4LZCD3FEU3)](https://codecov.io/gh/OkutaniDaichi0106/gomoqt)

## Содержание

- [Обзор](#обзор)
- [Возможности](#возможности)
- [Компоненты](#компоненты)
- [Разработка](#разработка)
- [Примеры](#примеры)
- [Документация](#документация)
- [Соответствие спецификации](#соответствие-спецификации)
- [Вклад в проект](#вклад-в-проект)
- [Лицензия](#лицензия)
- [Благодарности](#благодарности)

## Обзор

Эта реализация следует [спецификации MOQ Lite](https://kixelated.github.io/moq-drafts/draft-lcurley-moq-transfork.html), обеспечивая основу для создания приложений реального времени для потоковой передачи мультимедиа с использованием транспорта QUIC. MOQ Lite — это упрощённая версия протокола Media over QUIC Transport, разработанная для снижения задержек и уменьшения сложности при сохранении основных преимуществ доставки мультимедиа на основе QUIC.

## Возможности

- **Протокол MOQ Lite**: Основная реализация спецификации MOQ Lite
- **Поддержка WebTransport**: Полная поддержка подключений WebTransport в браузерах
- **Поддержка прямого QUIC**: Прямые QUIC-подключения для нативных приложений
- **Управление треками**: Паттерн Publisher/Subscriber для обработки медиатреков
- **Мультиплексированная потоковая передача**: Эффективное мультиплексирование нескольких медиатреков
- **Примеры приложений**: Полные примеры, демонстрирующие различные случаи использования

- **Потоковая передача в реальном времени**:
	Минимальная задержка от источника до получателя для интерактивных сценариев (live-трансляции, видеоконференции, мониторинг с низкой задержкой). Подходит для случаев, где отзывчивость критична для пользовательского опыта.

- **Непрерывная потоковая передача**:
	Надёжное воспроизведение при изменяющихся условиях сети. Основано на примитивах QUIC/WebTransport для уменьшения замираний и быстрого восстановления после потерь пакетов.

- **Эффективная доставка контента**:
	Оптимизации на уровне протокола и мультиплексирование снижают накладные расходы соединения и стоимость инфраструктуры при обслуживании большого количества одновременных зрителей или потоков.

- **Плавное воспроизведение**:
	Управление джиттером и буферизацией для снижения количества перебуферизаций и обеспечения плавного, непрерывного воспроизведения.

- **Оптимизированное качество**:
	Адаптивные схемы передачи данных приоритетно поддерживают приемлемое качество при ограниченной пропускной способности, обеспечивая стабильный пользовательский опыт на разных устройствах.

## Компоненты

### moqt

Основной пакет Go для реализации и обработки протокола Media over QUIC (MOQ).

### moq-web

Реализация MOQ на TypeScript для веба.

### interop

Инструменты и примеры для тестирования совместимости между различными реализациями MOQ.

## Разработка

### Необходимые инструменты

- Go 1.25.0 или новее
- Система сборки [Mage](https://magefile.org/) (установка: `go install github.com/magefile/mage@latest`)

### Начало работы

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/OkutaniDaichi0106/gomoqt.git
   cd gomoqt
   ```

2. Установите пакет:
   ```bash
   go get github.com/OkutaniDaichi0106/gomoqt
   ```

3. Установите инструмент сборки Mage:
   ```bash
   go install github.com/magefile/mage@latest
   ```

### Команды разработки

#### Запуск примеров

```bash
# Запустить сервер interop
mage interop:server

# В другом терминале запустить клиента interop (Go)
mage interop:client go

# Или запустить клиента на TypeScript
mage interop:client ts
```

#### Проверка качества кода

```bash
# Форматирование кода
mage fmt

# Запуск линтера (требуется golangci-lint: go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest)
mage lint

# Запуск проверок качества (fmt и lint)
mage check

# Запуск всех тестов
mage test:all

# Запуск тестов с покрытием
mage test:coverage
```

#### Сборка и очистка

```bash
# Сборка кода
mage build

# Очистка сгенерированных файлов
mage clean

# Показ доступных команд
mage help
```

### Примеры

Каталог [examples](examples) содержит примеры приложений, демонстрирующих
использование gomoqt:

- **Interop Server и Client** (`cmd/interop/`): Тестирование совместимости между
  различными реализациями MOQ
- **Пример трансляции** (`examples/broadcast/`): Демонстрация функциональности
  вещания
- **Пример эхо-сервера** (`examples/echo/`): Простой эхо-сервер и клиент
- **Нативный QUIC** (`examples/native_quic/`): Примеры прямых QUIC-подключений
- **Релей** (`examples/relay/`): Функциональность ретрансляции потоков
  мультимедиа

### Документация

- [GoDoc](https://pkg.go.dev/github.com/OkutaniDaichi0106/gomoqt)
- [Спецификация MOQ Lite](https://kixelated.github.io/moq-drafts/draft-lcurley-moq-transfork.html)
- [Статус реализации](moqt/README.md) — Подробное отслеживание прогресса
  реализации

## Соответствие спецификации

Эта реализация ориентирована на спецификацию MOQ Lite, которая представляет упрощённый подход к Media over QUIC Transport. Текущее состояние реализации можно найти в [README пакета moqt](moqt/README.md), где приведено подробное отслеживание реализованных функций в соответствии с разделами спецификации.

## Вклад в проект

Мы приветствуем вклад в развитие проекта! Вот как вы можете помочь:

1. Сделайте форк репозитория.
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`).
3. Внесите изменения.
4. Проверьте качество кода:
   ```bash
   mage fmt
   mage lint
   mage test
   ```
5. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`).
6. Отправьте ветку (`git push origin feature/amazing-feature`).
7. Откройте Pull Request.

## Лицензия

Этот проект распространяется по лицензии MIT. См. [LICENSE](LICENSE) для
деталей.

## Благодарности

- [quic-go](https://github.com/quic-go/quic-go) — Реализация QUIC на Go
- [webtransport-go](https://github.com/quic-go/webtransport-go) — Реализация
  WebTransport на Go
- [Спецификация MOQ Lite](https://kixelated.github.io/moq-drafts/draft-lcurley-moq-transfork.html) —
  Спецификация, которой следует данная реализация